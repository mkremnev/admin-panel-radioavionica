<?phpdeclare(strict_types=1);namespace Test\Functional;use DomainException;use GuzzleHttp\Client;use function file_get_contents;use function json_decode;use function preg_match;use function strpos;use function substr;use function urlencode;use function var_dump;use const JSON_THROW_ON_ERROR;class MailerClient{    private Client $client;    public function __construct()    {        $this->client = new Client([            'base_uri' => 'http://mailer:8025',        ]);    }    public function clear(): void    {        $this->client->delete('/api/v1/messages');    }    public function hasEmailSentTo(string $email): bool    {        $response = $this->client->get('/api/v2/search?kind=to&query=' . urlencode($email));        $json = json_decode((string)$response->getBody(), true, 512, JSON_THROW_ON_ERROR);        return $json['total'] > 0;    }    public function getTokenEmailTo(string $email): string    {        $response = $this->client->get('/api/v2/search?kind=to&query=' . urlencode($email));        $json = json_decode((string)$response->getBody(), true, 512, JSON_THROW_ON_ERROR);        $body = $json['items'][0]['Content']['Body'];        preg_match('/[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}/i',$body, $matches);        if (empty($matches[0]))        {            throw new DomainException('Not found matches');        }        return $matches[0];    }}